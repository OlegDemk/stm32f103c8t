/*
 * Fingerprint_sensor_GT511C3.c
 *
 *  Created on: Dec 14, 2020
 *      Author: odemki
 */

#include "Fingerprint_sensor_GT511C3.h"

extern UART_HandleTypeDef huart2;

devinfo gDeviceInfo;

SB_OEM_PKT Command_Packet;				 // extern SB_OEM_PKT Command_Packet;

// ----------------------------------------------------------------------------
void finger_print_test_function(void)
{
	LED(1);
	HAL_Delay(500);
	LED(0);
	HAL_Delay(500);
}
// ----------------------------------------------------------------------------
int CalcChkSumOfCmdAckPkt( SB_OEM_PKT* pPkt )
{
	unsigned short wChkSum = 0;
	unsigned char * pBuf = (unsigned char*)pPkt;
	int i;

	for(i=0;i<(sizeof(SB_OEM_PKT)-SB_OEM_CHK_SUM_SIZE);i++)
		wChkSum += pBuf[i];

	return wChkSum;
}
// ----------------------------------------------------------------------------
int LED(unsigned char State)
{
//	SB_OEM_PKT* Command_Packet;
//	unsigned char Buffer[12];
//	unsigned char DataBuff[26];
	int rtn;
	unsigned char i;
	unsigned long tmp = 0;
//	Command_Packet = Buffer;
	/*********Change Baudrate Command***********/
	Command_Packet.Head1 = COMMAND_START_CODE1;
	Command_Packet.Head2 = COMMAND_START_CODE2;
	Command_Packet.wDevId = DEVICE_ID;
	Command_Packet.nParam = State;
	Command_Packet.wCmd = CMOSLED;
	tmp = CalcChkSumOfCmdAckPkt(&Command_Packet);
	Command_Packet.wChkSum = tmp;
	/*********Change Baudrate Command***********/

	//rtn = SendCommand(&Command_Packet.Head1,SB_OEM_PKT_SIZE);

	// Test send Data
	//uint8_t test_transmit[3] = {1,2,3};
	char test_transmit='1';
	rtn = HAL_UART_Transmit(&huart2, test_transmit, 1, 0x1000);

//	rtn = HAL_UART_Transmit(&huart2, Command_Packet.Head1, SB_OEM_PKT_SIZE, 1000);
//	if(rtn == HAL_ERROR)
//	{
//		return HAL_ERROR;
//	}
//	rtn = ReceiveCommand(&Command_Packet.Head1,SB_OEM_PKT_SIZE);
//	if(rtn == FAIL)
//		return FAIL;
//
//	if(Command_Packet.wCmd != ACK)
//		return Command_Packet.nParam;
//
//	rtn = CheckChkSumOfRpsAckPkt(&Command_Packet);
//	if(rtn != OK)
//		return rtn;

	return HAL_OK;
}
